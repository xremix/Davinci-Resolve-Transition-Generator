<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf-8">
  <title></title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <style media="screen">
  body{
    background-color: rgb(22, 22, 23);
    color: white;
  }
  a, a:link, a:visited{
    colr: rgb(46, 138, 230);

  }
  .download-container .fa{
    font-size:2em;
  }
  </style>
  <script>

  function getOriginalScript(id){
    return $(id).text();
  }

  function generateScript(config){
    config.startFrame = 0;
    config.endFrame = config.frames - 1;

    config.firstBlurFrame = config.startFrame + 1;
    config.lastBlurFrame = config.endFrame - 1;

    var scriptText = getOriginalScript("#preset");

    scriptText = scriptText.replace(/@STARTFRAME@/g, config.startFrame);
    scriptText = scriptText.replace(/@ENDFRAME@/g, config.endFrame);
    scriptText = scriptText.replace(/@FIRSTBLURFRAME@/g, config.firstBlurFrame);
    scriptText = scriptText.replace(/@LASTBLURFRAME@/g, config.lastBlurFrame);

    if(config.transition == "movetoleft"){
      scriptText = scriptText.replace(/@P1P1RX@/g, "-");
      scriptText = scriptText.replace(/@P1P2X@/g, "-");
      scriptText = scriptText.replace(/@P2P1RX@/g, "-");
    }else if(config.transition == "movetoright"){
      scriptText = scriptText.replace(/@P1P2LX@/g, "-");
      scriptText = scriptText.replace(/@P2P1X@/g, "-");
      scriptText = scriptText.replace(/@P2P2LX@/g, "-");
    }
    scriptText = scriptText.replace(/@P\dP\d..?@/g, "");
    console.log(scriptText);
    return scriptText;
  }

  function generateAllScriptLinks(){
    var frames = $("#frames").val();
    console.log(frames);
    $('#movetoleftlink').attr("href", "data:application/octet-stream;charset=utf-8;base64,"+btoa(generateScript({
      frames: frames,
      transition: "movetoleft"
    })));
    $('#movetorightlink').attr("href", "data:application/octet-stream;charset=utf-8;base64,"+btoa(generateScript({
      frames: frames,
      transition: "movetoright"
    })));
  }

  $(document).ready(function(){
    generateAllScriptLinks();
    $("input").keyup(function(){
      generateAllScriptLinks();
    });
  });
  </script>
  <style>
  #preset, #originalpreset{
    display: none;
  }
  </style>
</head>
<body>
  <div class="container">
    <div class="row">
      <div class="col-12">
        <h1>Davinci Resolve 15 Fusion - Transition Generator</h1>
        <form>
          <div class="form-group">
            <label for="exampleFormControlInput1">Transition Frame length</label>
            <input type="text" name="" id="frames" class="form-control" value="5">
          </div>
        </form>
      </div>
      <div class="col-6 text-center download-container">
        <a id="movetoleftlink" download="movetoleft.setting">
          <i class="fa fa-arrow-left"></i><i class="fa fa-camera"></i><br/>
          Download<br/>
          Move to Left Transition Preset
        </a>
      </div>
      <div class="col-6 text-center download-container">
        <a id="movetorightlink" download="movetoright.setting">
          <i class="fa fa-camera"></i><i class="fa fa-arrow-right"></i><br/>
          Download<br/>
          Move to Right Transition Preset
        </a>
      </div>
    </div>
  </div>

  <pre id="preset">
    {
      Tools = ordered() {
        transform1 = Transform {
          CtrlWZoom = false,
          NameSet = true,
          Inputs = {
            Center = Input {
              SourceOp = "Path1",
              Source = "Position",
            },
          },
          ViewInfo = OperatorInfo { Pos = { 214.667, 48.5758 } },
        },
        Path1 = PolyPath {
          DrawMode = "InsertAndModify",
          Inputs = {
            Displacement = Input {
              SourceOp = "Path1Displacement",
              Source = "Value",
            },
            PolyLine = Input {
              Value = Polyline {
                Points = {
                  { Linear = true, LockY = true, X = 0, Y = @P1P1Y@0, RX = @P1P1RX@0.333333333333333, RY = 0 },
                  { Linear = true, LockY = true, X = @P1P2X@1, Y = 0, LX = @P1P2LX@0.333333333333333, LY = 0 }
                }
              },
            },
          },
        },
        Path1Displacement = BezierSpline {
          SplineColor = { Red = 255, Green = 0, Blue = 255 },
          NameSet = true,
          KeyFrames = {
            [@STARTFRAME@] = { 0, RH = { 1.33333333333333, 0.333333333333333 }, Flags = { Linear = true, LockedY = true } },
            [@ENDFRAME@] = { 1, LH = { 2.66666666666667, 0.666666666666667 }, Flags = { Linear = true, LockedY = true } }
          }
        },
        Merge1 = Merge {
          Inputs = {
            Background = Input {
              SourceOp = "transform1",
              Source = "Output",
            },
            Foreground = Input {
              SourceOp = "Transform2",
              Source = "Output",
            },
            PerformDepthMerge = Input { Value = 0, },
          },
          ViewInfo = OperatorInfo { Pos = { 324.333, 64.4242 } },
        },
        Transform2 = Transform {
          NameSet = true,
          Inputs = {
            Center = Input {
              SourceOp = "Path2",
              Source = "Position",
            },
          },
          ViewInfo = OperatorInfo { Pos = { 216, 78.2727 } },
        },
        Path2 = PolyPath {
          DrawMode = "InsertAndModify",
          Inputs = {
            Displacement = Input {
              SourceOp = "Path2Displacement",
              Source = "Value",
            },
            PolyLine = Input {
              Value = Polyline {
                Points = {
                  { Linear = true, LockY = true, X = @P2P1X@1, Y = 0, RX = @P2P1RX@0.333333333333333, RY = 0 },
                  { Linear = true, LockY = true, X = 0, Y = 0, LX = @P2P2LX@0.333333333333333, LY = 0 }
                }
              },
            },
          },
        },
        Path2Displacement = BezierSpline {
          SplineColor = { Red = 255, Green = 0, Blue = 255 },
          NameSet = true,
          KeyFrames = {
            [@STARTFRAME@] = { 0, RH = { 1.33333333333333, 0.333333333333333 }, Flags = { Linear = true, LockedY = true } },
            [@ENDFRAME@] = { 1, LH = { 2.66666666666667, 0.666666666666667 }, Flags = { Linear = true, LockedY = true } }
          }
        },
        DirectionalBlur1 = DirectionalBlur {
          Inputs = {
            Length = Input {
              SourceOp = "DirectionalBlur1Length",
              Source = "Value",
            },
            Input = Input {
              SourceOp = "Merge1",
              Source = "Output",
            },
          },
          ViewInfo = OperatorInfo { Pos = { 433.333, 64.3333 } },
        },
        DirectionalBlur1Length = BezierSpline {
          SplineColor = { Red = 141, Green = 167, Blue = 243 },
          NameSet = true,
          KeyFrames = {
            [@STARTFRAME@] = { 0, RH = { 0.333333333333333, 0.0333333333333333 }, Flags = { Linear = true } },
            [@FIRSTBLURFRAME@] = { 0.1, LH = { 0.666666666666667, 0.0666666666666667 }, RH = { 1.66666666666667, 0.1 }, Flags = { Linear = true } },
            [@LASTBLURFRAME@] = { 0.1, LH = { 2.33333333333333, 0.1 }, RH = { 3.33333333333333, 0.0666666666666667 }, Flags = { Linear = true } },
            [@ENDFRAME@] = { 0, LH = { 3.66666666666667, 0.0333333333333333 }, Flags = { Linear = true } }
          }
        }
      },
      ActiveTool = "transform1"
    }
  </pre>
  <pre id="originalpreset">
    {
      Tools = ordered() {
        transform1 = Transform {
          CtrlWZoom = false,
          NameSet = true,
          Inputs = {
            Center = Input {
              SourceOp = "Path1",
              Source = "Position",
            },
          },
          ViewInfo = OperatorInfo { Pos = { 214.667, 48.5758 } },
        },
        Path1 = PolyPath {
          DrawMode = "InsertAndModify",
          Inputs = {
            Displacement = Input {
              SourceOp = "Path1Displacement",
              Source = "Value",
            },
            PolyLine = Input {
              Value = Polyline {
                Points = {
                  { Linear = true, LockY = true, X = 0, Y = 0, RX = -0.333333333333333, RY = 0 },
                  { Linear = true, LockY = true, X = -1, Y = 0, LX = 0.333333333333333, LY = 0 }
                }
              },
            },
          },
        },
        Path1Displacement = BezierSpline {
          SplineColor = { Red = 255, Green = 0, Blue = 255 },
          NameSet = true,
          KeyFrames = {
            [0] = { 0, RH = { 1.33333333333333, 0.333333333333333 }, Flags = { Linear = true, LockedY = true } },
            [4] = { 1, LH = { 2.66666666666667, 0.666666666666667 }, Flags = { Linear = true, LockedY = true } }
          }
        },
        Merge1 = Merge {
          Inputs = {
            Background = Input {
              SourceOp = "transform1",
              Source = "Output",
            },
            Foreground = Input {
              SourceOp = "Transform2",
              Source = "Output",
            },
            PerformDepthMerge = Input { Value = 0, },
          },
          ViewInfo = OperatorInfo { Pos = { 324.333, 64.4242 } },
        },
        Transform2 = Transform {
          NameSet = true,
          Inputs = {
            Center = Input {
              SourceOp = "Path2",
              Source = "Position",
            },
          },
          ViewInfo = OperatorInfo { Pos = { 216, 78.2727 } },
        },
        Path2 = PolyPath {
          DrawMode = "InsertAndModify",
          Inputs = {
            Displacement = Input {
              SourceOp = "Path2Displacement",
              Source = "Value",
            },
            PolyLine = Input {
              Value = Polyline {
                Points = {
                  { Linear = true, LockY = true, X = 1, Y = 0, RX = -0.333333333333333, RY = 0 },
                  { Linear = true, LockY = true, X = 0, Y = 0, LX = 0.333333333333333, LY = 0 }
                }
              },
            },
          },
        },
        Path2Displacement = BezierSpline {
          SplineColor = { Red = 255, Green = 0, Blue = 255 },
          NameSet = true,
          KeyFrames = {
            [0] = { 0, RH = { 1.33333333333333, 0.333333333333333 }, Flags = { Linear = true, LockedY = true } },
            [4] = { 1, LH = { 2.66666666666667, 0.666666666666667 }, Flags = { Linear = true, LockedY = true } }
          }
        },
        DirectionalBlur1 = DirectionalBlur {
          Inputs = {
            Length = Input {
              SourceOp = "DirectionalBlur1Length",
              Source = "Value",
            },
            Input = Input {
              SourceOp = "Merge1",
              Source = "Output",
            },
          },
          ViewInfo = OperatorInfo { Pos = { 433.333, 64.3333 } },
        },
        DirectionalBlur1Length = BezierSpline {
          SplineColor = { Red = 141, Green = 167, Blue = 243 },
          NameSet = true,
          KeyFrames = {
            [0] = { 0, RH = { 0.333333333333333, 0.0333333333333333 }, Flags = { Linear = true } },
            [1] = { 0.1, LH = { 0.666666666666667, 0.0666666666666667 }, RH = { 1.66666666666667, 0.1 }, Flags = { Linear = true } },
            [3] = { 0.1, LH = { 2.33333333333333, 0.1 }, RH = { 3.33333333333333, 0.0666666666666667 }, Flags = { Linear = true } },
            [4] = { 0, LH = { 3.66666666666667, 0.0333333333333333 }, Flags = { Linear = true } }
          }
        }
      },
      ActiveTool = "transform1"
    }
  </pre>
</body>
</html>
